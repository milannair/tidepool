# Railway configuration for tidepool-ingest service
#
# Required environment variables (set in Railway Dashboard â†’ Variables):
#   AWS_ACCESS_KEY_ID      - S3/R2 access key
#   AWS_SECRET_ACCESS_KEY  - S3/R2 secret key
#   AWS_ENDPOINT_URL       - S3 endpoint (e.g., https://<account>.r2.cloudflarestorage.com)
#   AWS_REGION             - S3 region (e.g., auto for R2)
#   BUCKET_NAME            - S3 bucket name
#
# Optional - Namespace configuration:
#   NAMESPACE              - Restrict to a single namespace (unset = dynamic)
#   ALLOWED_NAMESPACES     - Comma-separated allowlist (optional)
#   MAX_NAMESPACES         - Max active namespaces per replica (optional)
#   NAMESPACE_IDLE_TIMEOUT - Evict namespace state after inactivity (e.g., "10m")
#
# Optional - Compaction and indexing:
#   COMPACTION_INTERVAL    - How often to compact WAL (default: "5m")
#   QUANTIZATION           - none | f16 | sq8 (default: "sq8" - recommended)
#   IVF_ENABLED            - Enable IVF clustering (default: "true")
#   IVF_MIN_SEGMENT_SIZE   - Min vectors for IVF (default: "10000")
#   HNSW_M                 - HNSW graph connectivity (default: "16")
#   HNSW_EF_CONSTRUCTION   - HNSW build quality (default: "200")
#
# Optional - Full-text search:
#   TEXT_INDEX_ENABLED     - Build BM25 text indexes (default: "true")
#   TEXT_ENABLE_STEMMING   - Enable Porter stemming (default: "true")
#   TEXT_LANGUAGE          - Stemming language (default: "english")
#   TEXT_STOPWORDS         - Comma-separated custom stopwords (optional)
#   TEXT_MIN_TOKEN_LEN     - Minimum token length (default: "2")
#   TEXT_MAX_TOKEN_LEN     - Maximum token length (default: "32")

[build]
builder = "dockerfile"
dockerfilePath = "ingest/Dockerfile"
watchPatterns = [
  "ingest/src/**",
  "crates/**",
  "Cargo.toml",
  "Cargo.lock",
  "ingest/Dockerfile"
]

[env]
RAILWAY_DOCKERFILE_PATH = "ingest/Dockerfile"

[deploy]
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
healthcheckPath = "/health"
healthcheckTimeout = 30
